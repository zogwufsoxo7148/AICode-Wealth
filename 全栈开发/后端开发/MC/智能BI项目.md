[toc]

### 一、任务安排

1. 过一份项目，看看有哪些项目适合自己，尝试写进去。
2. 每过一份项目，会看自己的，瞧瞧哪些适合自己，稍微回看课程就可以补上来的。

### 二、详细梳理

- AIGC应用开发、A!提问技巧、系统优化、分布式限流、线程池、异步化、消息队列等一系列重点知识
- 整理的是：智能BI项目

![image-20240615100627087](https://typora-xubang.oss-cn-hangzhou.aliyuncs.com/2024_xubang/image-20240615100627087.png?AI_make_money=VX_AI19858122061)

#### 1.安全性问题

> 参考链接：https://www.code-nav.cn/course/1790980531403927553/section/1791384762255527938?contentType=video&type=#

- 一般涉及用户自主上传，都必须做好校验，解决安全性问题。
  - 校验
    - 文件大小
    - 文件格式：推荐hutool的一个工具：FileUtil.getSuffix(…)
    - 文件合规性（一般使用第三方，比如：腾讯云、阿里云）
  - 避免：恶意上传浪费服务资源。



#### 2.性能存储优化

> ==但凡是涉及用户自主存储的情况，一定要考虑性能优化==

- 问题：如果一个表的单个字段存储用户上传的原始数据，一旦后续随着数据量大激增，包括字段本身存储的数据变大，后续查询，特别消耗性能；尤其会出现一条数据，比如说100M，那么很可能会影响其他用户的使用体验。
  - 解决方案：分库分表 ⭐️⭐️⭐️
    - 水平分表，垂直分库。分表一般是根据某个字段来进行，降低访问压力，分库一般是根据业务来进行，比如：支付业务、订单业务。
    - 分开查询：存储数据，不使用字段；而是为每一个数据表，创建一个单独的数据表。
  - 具体实现：动态SQL
    1. 思考清楚哪一部分是动态的，比如：单独数据表的后缀动态ID

#### 3.限流问题

> ==但凡是涉及成本、流量，一定要做好限流问题的处理==
>
> 比如：普通用户50次，会员VIP200次。
>
> https://www.code-nav.cn/course/1790980531403927553/section/1791384722711629825?contentType=video&type=

- 问题：针对于AI的接口，每一次调用，都需要消耗成本，避免用户恶意损耗。

  - 解决方案：

    1. 限制用户调用总次数，卡住总成本
    2. 避免用户在短时间内疯狂使用，导致服务器资源被占满，其他用户无法使用。 ——> 限流
       - 打印日志，观察其他用户的使用频率，比如：1秒1次。

  - 高频知识：常见限流算法

    - 固定窗口算法
      - 基本认识：固定时间段，处理固定次数；比如：每小时处理10次
      - 缺点：流量突刺，比如：59分，10次访问，61分，10次访问，流量突刺。
    - 滑动窗口算法
      - 优点：解决了流量突刺问题
      - 缺点：不完全解决流量突刺问题，滑动单位究竟怎么定义合适，需要进一步判断。
    - 漏桶限流（推荐）
      - 基本认识：每秒漏下1个请求，如果桶内流量冲满，那就溢出，被拒绝
      - 优点：一定程度应对流量突刺，一方面可以接大量流量，一方面可以稳定处理
      - 缺点：固定的速率，只能一个个处理
    - 令牌桶算法（推荐）
      - 基本认识：管理员每秒发10个令牌，过来的请求但凡领取到令牌，就有资格同时执行请求
      - 优点：能够同时并发处理请求
      - 缺点：还是存在单位时间选取的问题
    - ==一般推荐后两种算法，具体选择使用哪种？如果你希望系统稳定处理请求，那就漏桶算法；如果你想要可以并发高效处理请求，那就令牌桶算法==

  - 限流的粒度

    ![image-20240615111838833](https://typora-xubang.oss-cn-hangzhou.aliyuncs.com/2024_xubang/image-20240615111838833.png?AI_make_money=VX_AI19858122061)

  - 具体实现：https://www.code-nav.cn/course/1790980531403927553/section/1791384686154076161?contentType=video&type=

    - 单机限流：每个服务器单独限流，一般适用于单体项目，也就是项目只有一个服务器

    - 分布式限流：微服务项目，建议使用分布式限流

      1. 统计用户的使用频率数据，存储到一个共享的数据中心，比如：Redisson

      2. 在网关层，集中进行统计，比如：Sentinel、Spring Cloud GateWay

      3. 具体实现：redis的具体安装，可以看伙伴匹配系统。

         - 引入依赖

         - 创建配置类

           ![image-20240615110212653](https://typora-xubang.oss-cn-hangzhou.aliyuncs.com/2024_xubang/image-20240615110212653.png?AI_make_money=VX_AI19858122061)

         - 具体怎么使用，直接GPT生成

           - 具体参数：看文档、问GPT、看源码

           ![](https://typora-xubang.oss-cn-hangzhou.aliyuncs.com/2024_xubang/image-20240615110657911.png?AI_make_money=VX_AI19858122061)

           ![image-20240615111803780](https://typora-xubang.oss-cn-hangzhou.aliyuncs.com/2024_xubang/image-20240615111803780.png?AI_make_money=VX_AI19858122061)

         - ==一个特别好的习惯：XXXManager，可以规定为通用能力，方便迁移使用；XXService，是业务单独使用的能力==

#### 4.异步化业务流程

> [具体链接：](https://www.code-nav.cn/course/1790980531403927553/section/1791384589504729090?contentType=video&type=)https://www.code-nav.cn/course/1790980531403927553/section/1791384589504729090?contentType=video&type=

==但凡是调用三方的接口，需要等待时间长或者第三方服务的服务能力有限，都可以使用异步进行处理，避免影响用户体验==

- 问题：

  - 用户操作耗时的功能，需要等待的问题
  - 任务队列的最大容量是多少？线程池问题
  - 任务队列具体怎么实现？线程池问题

- 基本概念：

  - 同步、异步

  - 标准异步化的业务流程

    1. 当用户需要执行一个耗时非常长的操作，不需要在页面进行等待，而是直接进行其他操作
    2. 用户执行新的任务的时候
       - 当任务队列存在其他排队任务，新来的任务继续排队
       - 当任务队列没有其他任务的时候，可以直接执行
       - 当任务队列已经满了的时候，可以拒绝 或者 存储到数据库中，等后续再去数据库中进行捞取执行
    3. 程序从任务队列中获取任务进行执行，执行完毕并修改任务的状态
    4. 任务执行完毕，想办法通知用户 或者 让用户可以自己查到任务的状态，这样可以优化用户的使用体验
    5. 如果我们的任务环节特别多，可以每执行完一个任务，我们就记录一下任务的状态

  - 具体异步化的业务流程

    1. 当用户提交数据表的时候，直接将数据表存储到数据库中
    2. 当用户进入数据分析页面，可以直接看到过往的数据处理的状态：成功、进行中、失败

    ![image-20240615121757102](https://typora-xubang.oss-cn-hangzhou.aliyuncs.com/2024_xubang/image-20240615121757102.png?AI_make_money=VX_AI19858122061)

- 具体实现：线程池

  - 为什么需要线程池？轻松管理线程，协调任务的执行

    - 线程的管理比较复杂：什么时候新增线程？什么时候退掉线程？
    - 任务存取比较复杂：什么时候执行任务？什么时候拒绝任务？

  - 线程池的具体实现？

    - ==不建议使用Spring中的线程池，更建议使用Java的JUC并发包中的实现==

    - 怎么确定线程池参数？

    - ⭐️⭐️⭐️资源隔离策略，普通用户 和 VIP，使用不同的队列

    - 线程池的参数具体怎么设置？

      ![image-20240615140904376](https://typora-xubang.oss-cn-hangzhou.aliyuncs.com/2024_xubang/image-20240615140904376.png?AI_make_money=VX_AI19858122061)

    - 具体的策略

      ==反向压力是一个特别加分的名词，只要你讲出来==

      ![image-20240615152936753](https://typora-xubang.oss-cn-hangzhou.aliyuncs.com/2024_xubang/image-20240615152936753.png?AI_make_money=VX_AI19858122061)

==推进到32节课==





